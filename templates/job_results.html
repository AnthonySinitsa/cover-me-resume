{% load custom_filters %}
<head>
    <nav>
        <a href="{% url 'home' %}">Home</a>
        <a href="{% url 'profile' %}">Profile</a>
    </nav>
</head>
<ul>
    {% for index, job in jobs|enumerate %}
        <li>
            <strong>Retrieved At:</strong> {{ job.post_date|date:"F d, Y" }}<br>
            <strong>Company:</strong> {{ job.company }}<br>
            <strong>Title:</strong> {{ job.title }}<br>
            <strong>Description:</strong> {{ job.description|safe }}<br>
            <strong>Location:</strong> {{ job.location }}<br>
            <a href="{{ job.company_overview_link }}" target="_blank">Company Overview</a>
            <a href="{% url 'generate_cover_letter' index %}">Generate Cover Letter</a>
        </li>
    {% endfor %}
</ul>

<script>
    function checkTaskStatus(taskId) {
        fetch(`/task_status/${taskId}/`).then(response => response.json()).then(data => {
            if (data.status === 'SUCCESS') {
                // Display the results
                console.log(data.result);
                // TODO: Process and display data.result as needed
            } else if (data.status === 'FAILURE') {
                console.error('Task failed');
                // TODO: Handle task failure (e.g., display an error message)
            } else {
                // Task is still running, check again in a few seconds
                setTimeout(() => checkTaskStatus(taskId), 5000);
            }
        });
    }

    // Start polling
    checkTaskStatus('{{ task_id }}');  // Pass the task ID from the context to the JavaScript function
</script>
